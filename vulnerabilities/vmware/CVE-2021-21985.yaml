id: CVE-2021-21985

info:
  name: VMware vSphere Client (HTML5) - 远程命令执行(CVE-2021-21985)
  author: D0rkerDevil
  severity: critical
  description: |
    VMware vSphere vCenter Server 的 vsphere-ui 基于 OSGi 框架,包含上百个 bundle.
    在其中的 buyndle 中的 h5-vsan 相关的 bundle 提供了一些 API 端点,并且未经过授权即可访问.
    通过进一步的利用,发现其中 VsanHttpProvider.py 存在SSRF漏洞,可以执行任意 Spring Bean 的方法.
    调用 systemProperties bean 来达到不出网 RCE 命令回显,目前网上公开的都是这2种利用方式利用JNDI注入和直接命令回显.
  remediation: 升级产品到最新版本.
  metadata:
    max-request: 1
  tags: vcenter

http:
  - raw:
      - |
        POST /ui/h5-vsan/rest/proxy/service/com.vmware.vsan.client.services.capability.VsanCapabilityProvider/getClusterCapabilityData HTTP/1.1
        Host: {{Hostname}}
        Accept: */*
        Content-Type: application/json

        {"methodInput":[{"type":"ClusterComputeResource","value": null,"serverGuid": null}]}

    matchers:
      - type: word
        words:
          - '{"result":{"isDisconnected":'
        part: body
